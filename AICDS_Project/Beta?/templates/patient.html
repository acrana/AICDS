<!-- templates/patient.html -->
{% extends "base.html" %}

{% block content %}
<h2>Patient Details</h2>
<p><strong>Name:</strong> {{ patient.first_name }} {{ patient.last_name }}</p>
<p><strong>Date of Birth:</strong> {{ patient.date_of_birth }}</p>
<p><strong>Gender:</strong> {{ patient.gender }}</p>
<p><strong>Contact:</strong> {{ patient.phone }}, {{ patient.email }}</p>
<p><strong>Address:</strong> {{ patient.address }}</p>

<h3>Medication Orders</h3>
<a href="{{ url_for('new_order', patient_id=patient.patient_id) }}">Add New Order</a>
<table>
    <tr>
        <th>Medication</th>
        <th>Dosage</th>
        <th>Frequency</th>
        <th>Duration</th>
        <th>Status</th>
        <th>Provider</th>
        <th>Order Date</th>
    </tr>
    {% for _, row in orders.iterrows() %}
    <tr>
        <td>{{ row.medication_name }}</td>
        <td>{{ row.dosage }}</td>
        <td>{{ row.frequency }}</td>
        <td>{{ row.duration }}</td>
        <td>{{ row.status }}</td>
        <td>{{ row.provider_first }} {{ row.provider_last }}</td>
        <td>{{ row.order_date }}</td>
    </tr>
    {% endfor %}
</table>

<h3>Lab Results</h3>
<table>
    <tr>
        <th>Test Name</th>
        <th>Result</th>
        <th>Units</th>
        <th>Test Date</th>
    </tr>
    {% for _, row in lab_results.iterrows() %}
    <tr>
        <td>{{ row.test_name }}</td>
        <td>{{ row.result_value }}</td>
        <td>{{ row.units }}</td>
        <td>{{ row.test_date }}</td>
    </tr>
    {% endfor %}
</table>

<h3>Active Alerts</h3>
{% if alerts.empty %}
    <p>No active alerts for this patient.</p>
{% else %}
    <ul>
    {% for _, alert in alerts.iterrows() %}
        <li><strong>{{ alert.lab_test_name }}:</strong> {{ alert.alert_message }} ({{ alert.alert_date }})</li>
    {% endfor %}
    </ul>
{% endif %}

{% endblock %}
